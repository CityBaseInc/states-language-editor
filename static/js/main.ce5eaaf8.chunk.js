(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(t){t.exports={StartAt:"Start",States:{Start:{Type:"Task",Resource:"Screen:lookup_asset",TransitionEvent:":submit",InputPath:"",OutputPath:"",ResourcePath:"",Next:"Lookup"},Lookup:{Type:"Task",Resource:"Lookup:asset",TransitionEvent:":success",Catch:[{ErrorEquals:[":not_found"],Next:"DisplayNotFound"},{ErrorEquals:[":error"],Next:"DisplayError"}],Next:"DisplayAsset"},DisplayAsset:{Type:"Task",Resource:"Screen:asset_display",TransitionEvent:"",End:!0},DisplayNotFound:{Type:"Task",Resource:"Screen:not_found",TransitionEvent:":reset",Catch:[],InputPath:"",OutputPath:"",ResourcePath:"",Next:"Start",End:!1},DisplayError:{Type:"Task",Resource:"Screen:error",TransitionEvent:":reset",Catch:[],InputPath:"",OutputPath:"",ResourcePath:"",Next:"Start",End:!1}}}},188:function(t,e,n){t.exports=n(389)},388:function(t,e,n){},389:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(26),i=n.n(o),c=n(33),u=n(77),s=n(76),d=n(107),p={editor_graph:{},d3_graph:{nodes:[],edges:[]},states_language_graph:d,states_language_graph_editor:d,graph_loaded:!0};var l=Object(s.b)(function(t,e){var n=Object(u.a)({},t);switch(e.type){case"SET_EDITOR_GRAPH":n.editor_graph=e.graph;break;case"SET_D3_GRAPH":n.d3_graph=e.graph;break;case"SET_STATES_LANGUAGE_GRAPH":n.states_language_graph=e.graph;break;case"SET_STATES_LANGUAGE_EDITOR_GRAPH":n.states_language_graph_editor=n.states_language_graph;break;case"SET_GRAPH_LOADED":n.graph_loaded=e.graph_loaded}return n},p),h=n(78),m=n(5),f=n(180),v=n(415),g=n(416),E=n(417),b=n(418),O=n(419),_=n(420),w=n(421),y=n(390),j=n(2),C=n.n(j),S=n(15),k=n(16),T=n(18),x=n(17),N=n(19),P=n(4),R=n(37),A=n(176),I=n(182),G=n(178),D=n.n(G),L=n(108),H=n(179),B=n.n(H),J=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).apply(this,arguments))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"render",value:function(){var t=this.props,e=t.node,n=t.bindSocket,a=t.bindControl,o=this.state,i=o.outputs,c=o.controls,u=o.inputs,s=o.selected;return r.a.createElement("div",{className:"node ".concat(s," ").concat(e.name)},r.a.createElement("div",{className:"title"},e.name),u.map(function(t){return r.a.createElement("div",{className:"input",key:t.key},r.a.createElement(R.c,{type:"input",socket:t.socket,io:t,innerRef:n}),!t.showControl()&&r.a.createElement("div",{className:"input-title"},t.name),t.showControl()&&r.a.createElement(R.a,{className:"input-control",control:t.control,innerRef:a}))}),c.map(function(t){return r.a.createElement(R.a,{className:"control",key:t.key,control:t,innerRef:a})}),i.map(function(t){return r.a.createElement("div",{className:"output",key:t.key},r.a.createElement("div",{className:"output-title"},t.name),r.a.createElement(R.c,{type:"output",socket:t.socket,io:t,innerRef:n}))}))}}]),e}(R.b),W=function(t){function e(t,n,a){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(S.a)(this,e),(r=Object(T.a)(this,Object(x.a)(e).call(this,n))).emitter=t,r.key=n,r.component=e.component;var c=a.data[n]||o;return a.data[n]=c,r.props={readonly:i,value:c,onChange:function(t){r.setValue(t),r.emitter.trigger("process")},placeholder:n},r}return Object(N.a)(e,t),Object(k.a)(e,[{key:"setValue",value:function(t){this.props.value=t,this.putData(this.key,t),this.update()}}]),e}(P.c.Control);W.component=function(t){var e=t.value,n=t.onChange,a=t.placeholder;return r.a.createElement("input",{value:e,placeholder:a,ref:function(t){t&&t.addEventListener("pointerdown",function(t){return t.stopPropagation()})},onChange:function(t){return n(t.target.value)}})};var z=function(t){function e(t,n,a){var r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(S.a)(this,e),(r=Object(T.a)(this,Object(x.a)(e).call(this,n))).emitter=t,r.key=n,r.component=e.component;var i=a.data[n]||"";return a.data[n]=i,r.props={readonly:o,value:i,onChange:function(t){r.setValue(t),r.emitter.trigger("process")},placeholder:n},r}return Object(N.a)(e,t),Object(k.a)(e,[{key:"setValue",value:function(t){this.props.value=t,this.putData(this.key,t),this.update()}}]),e}(P.c.Control);z.component=function(t){var e=t.value,n=t.onChange,a=t.placeholder;return r.a.createElement("input",{type:"number",value:e,placeholder:a,ref:function(t){t&&t.addEventListener("pointerdown",function(t){return t.stopPropagation()})},onChange:function(t){return n(t.target.value)}})};var q=function(t){function e(t,n,a){var r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(S.a)(this,e),(r=Object(T.a)(this,Object(x.a)(e).call(this,n))).emitter=t,r.key=n,r.component=e.component;var i=a.data[n]||!1;return a.data[n]=i,r.props={readonly:o,value:i,onChange:function(t){r.setValue(t),r.emitter.trigger("process")},placeholder:n},r}return Object(N.a)(e,t),Object(k.a)(e,[{key:"setValue",value:function(t){this.props.value=t,this.putData(this.key,t),this.update()}}]),e}(P.c.Control);q.component=function(t){var e=t.value,n=t.onChange,a=t.placeholder;return r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:a,checked:e,ref:function(t){t&&t.addEventListener("pointerdown",function(t){return t.stopPropagation()})},onChange:function(t){return n(t.target.checked)}}),a)};var V=function(t){var e=1,n=st(t.States),a={id:"states-language@0.1.0",nodes:{}};return a.nodes=n.reduce(function(t,n){return t[e.toString()]={id:e,data:X(n),name:n.Type,inputs:{start:{connections:[]}},outputs:{transition_event:{connections:[]}},position:[100*e,100*e]},e++,t},a.nodes),a.nodes=U(n,a.nodes,e),a},U=function(t,e,n){return t.reduce(function(t,e){if(e.Catch&&(t=e.Catch.reduce(function(t,a){var r=M(e.id,t),o=M(a.Next,t);return t[n.toString()]=F(n,"catch_events","start","CatchEvent",a.ErrorEquals.join(","),r,o),n++,t},t)),e.Choices&&(t=e.Choices.reduce(function(t,a){var r=M(e.id,t),o=M(a.Next,t);return t[n.toString()]=F(n,"choice_events","start","ChoiceEvent",a.StringEquals,r,o),n++,t},t)),e.Next){var a=M(e.id,t),r=M(e.Next,t);t[n.toString()]=F(n,"transition_event","start","TransitionEvent",e.TransitionEvent,a,r),n++}return t},e)},F=function(t,e,n,a,r,o,i){return o.outputs=o.outputs||{},o.outputs[e]=o.outputs[e]||{},o.outputs[e].connections=o.outputs[e].connections||[],o.outputs[e].connections.push({node:t,input:"event",data:{}}),i.inputs=i.inputs||{},i.inputs[n]=i.inputs[n]||{},i.inputs[n].connections=i.inputs[n].connections||[],i.inputs[n].connections.push({node:t,output:"next",data:{}}),{name:a,id:t,position:[100*t,100*t],data:{event:r},inputs:{event:{connections:[{node:o.id,output:e,data:{}}]}},outputs:{next:{connections:[{node:i.id,input:n,data:{}}]}}}},M=function(t,e){for(var n in e)if(e[n].data.name===t)return e[n]},X=function(t){switch(t.Type){case"Task":return $(t);case"Choice":return K(t);case"Wait":return Q(t);default:return{}}},$=function(t){return{resource:t.Resource,name:t.id,input_path:t.InputPath,output_path:t.OutputPath,resource_path:t.ResourcePath,is_end:!!t.End&&t.End}},K=function(t){return{resource:t.Resource,name:t.id,input_path:t.InputPath,output_path:t.OutputPath,is_end:!!t.End&&t.End}},Q=function(t){return{name:t.id,seconds:t.Seconds,seconds_path:t.SecondsPath,timestamp:t.Timestamp,timestamp_path:t.TimestampPath,is_end:!!t.End&&t.End}},Y=function(t,e){return t.reduce(function(t,n){return t[n.data.name]=Z(n,e),t},{})},Z=function(t,e){switch(t.name){case"Task":return tt(t,e);case"Wait":return nt(t,e);case"Choice":return et(t,e);default:return{}}},tt=function(t,e){var n=ct(t,e),a=n?n.type.join(","):"",r=at(t,e).map(function(t){return{ErrorEquals:t.type,Next:t.target.data.name}});return{Type:t.name,Resource:t.data.resource,TransitionEvent:a,Catch:r,InputPath:t.data.input_path,OutputPath:t.data.output_path,ResourcePath:t.data.resource_path,Next:n?n.target.data.name:"",End:t.data.is_end}},et=function(t,e){var n=ot(t,e).map(function(t){return{StringEquals:t.type.join(", "),Next:t.target.data.name}});return{Type:t.name,Resource:t.data.resource,Choices:n,InputPath:t.data.input_path,OutputPath:t.data.output_path}},nt=function(t,e){var n=ct(t,e),a=n?n.type.join(","):"",r={Type:t.name,TransitionEvent:a,Next:n?n.target.data.name:"",End:t.data.is_end};return t.data.seconds&&(r.Seconds=parseInt(t.data.seconds)),t.data.timestamp&&(r.Timestamp=t.data.timestamp),t.data.timestamp_path&&(r.TimestampPath=t.data.timestamp_path),t.data.seconds_path&&(r.SecondsPath=t.data.seconds_path),r},at=function(t,e){return e.filter(function(e){return rt(e,t)})},rt=function(t,e){return t.source.data.name===e.data.name&&"CatchEvent"===t.event.name},ot=function(t,e){return e.filter(function(e){return it(e,t)})},it=function(t,e){return t.source.data.name===e.data.name&&"ChoiceEvent"===t.event.name},ct=function(t,e){return e.find(function(e){return ut(e,t)})},ut=function(t,e){return t.source.data.name===e.data.name&&"TransitionEvent"===t.event.name},st=function(t){return Object.keys(t).reduce(function(e,n){return t[n].id=n,e.push(t[n]),e},[])},dt=function(t){return t.filter(function(t){return!t.name.endsWith("Event")})},pt=function(t,e){return t.flatMap(function(t){return ht(t,e)})},lt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.map(function(t){return{id:e++,label:t.name,name:t.data.name}})},ht=function(t,e,n){return Object.keys(t.outputs).flatMap(function(n){return function(t,e,n){return e.outputs[t].connections.reduce(function(t,a){var r=n.nodes[a.node.toString()];if(r.outputs.next.connections.length>0){var o=r.outputs.next.connections[0].node.toString(),i=n.nodes[o];t.push({source:e,target:i,event:r,type:gt(r)})}return t},[])}(n,t,e)})},mt=function(t,e){return t.map(function(t){var n=Et(t.target.data.name,e);return{source:Et(t.source.data.name,e),target:n,type:t.type}})};function ft(t){var e=st(t.nodes),n=dt(e),a=pt(n,t);return{StartAt:"Test",States:Y(n,a)}}function vt(t){var e=st(t.nodes),n=dt(e),a=lt(n),r=pt(n,t);return{nodes:a,edges:mt(r,a)}}function gt(t){var e="";return t.data.errors?e=t.data.errors:t.data.event?e=t.data.event:t.data.events&&(e=t.data.events),e.split(",").map(function(t){return t.trim()})}function Et(t,e){return e.findIndex(function(e){return e.name===t})}var bt="SET_D3_GRAPH",Ot="SET_STATES_LANGUAGE_GRAPH",_t="SET_GRAPH_LOADED",wt="SET_STATES_LANGUAGE_EDITOR_GRAPH";function yt(t){return{type:bt,graph:t}}function jt(t){return{type:Ot,graph:t}}function Ct(t){return{type:_t,graph_loaded:t}}var St=new P.c.Socket("Transition Event"),kt=new P.c.Socket("Catch Event"),Tt=new P.c.Socket("Choice Event"),xt=new P.c.Socket("Next"),Nt=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).call(this,"Task"))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"builder",value:function(t){var e=new P.c.Input("start","Start",xt,!0),n=new P.c.Output("transition_event","Transition Event",St),a=new P.c.Output("catch_events","Catch Events",kt),r=new W(this.editor,"name",t),o=new W(this.editor,"resource",t),i=new W(this.editor,"input_path",t),c=new W(this.editor,"resource_path",t),u=new W(this.editor,"output_path",t),s=new q(this.editor,"is_end",t);return t.addInput(e).addOutput(n).addOutput(a).addControl(r).addControl(o).addControl(i).addControl(c).addControl(u).addControl(s)}}]),e}(P.c.Component),Pt=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).call(this,"Choice"))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"builder",value:function(t){var e=new P.c.Input("start","Start",xt,!0),n=new P.c.Output("choice_events","Choice Events",Tt),a=new W(this.editor,"resource",t),r=new W(this.editor,"name",t),o=new W(this.editor,"input_path",t),i=new W(this.editor,"output_path",t);return t.addInput(e).addOutput(n).addControl(r).addControl(a).addControl(o).addControl(i)}}]),e}(P.c.Component),Rt=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).call(this,"Wait"))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"builder",value:function(t){var e=new P.c.Input("start","Start",xt,!0),n=new P.c.Output("transition_event","Transition Event",St),a=new W(this.editor,"name",t),r=new z(this.editor,"seconds",t),o=new W(this.editor,"timestamp",t),i=new W(this.editor,"seconds_path",t),c=new W(this.editor,"timestamp_path",t),u=new q(this.editor,"is_end",t);return t.addInput(e).addOutput(n).addControl(a).addControl(r).addControl(o).addControl(i).addControl(c).addControl(u)}}]),e}(P.c.Component),At=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).call(this,"TransitionEvent"))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"builder",value:function(t){var e=new P.c.Input("event","=",St,!0),n=new P.c.Output("next","Next",xt),a=new W(this.editor,"event",t);return t.addInput(e).addOutput(n).addControl(a)}}]),e}(P.c.Component),It=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).call(this,"CatchEvent"))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"builder",value:function(t){var e=new P.c.Input("event","=",kt,!0),n=new P.c.Output("next","Next",xt),a=new W(this.editor,"event",t);return t.addInput(e).addOutput(n).addControl(a)}}]),e}(P.c.Component),Gt=function(t){function e(){return Object(S.a)(this,e),Object(T.a)(this,Object(x.a)(e).call(this,"ChoiceEvent"))}return Object(N.a)(e,t),Object(k.a)(e,[{key:"builder",value:function(t){var e=new P.c.Input("event","=",Tt),n=new P.c.Output("next","Next",xt),a=new W(this.editor,"event",t);return t.addInput(e).addOutput(n).addControl(a)}}]),e}(P.c.Component),Dt=function(t,e){var n,a;return C.a.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return");case 2:n=[new Nt,new Pt,new Rt,new Gt,new It,new At],(a=new P.c.NodeEditor("states-language@0.1.0",t)).use(A.a),a.use(R.d,{component:J}),a.use(I.a),a.use(L.a),a.use(B.a),a.use(D.a,{margin:{x:50,y:50},depth:0}),n.map(function(t){return a.register(t)}),a.on("process nodecreated noderemoved connectioncreated connectionremoved",function(){var t,e,n;return C.a.async(function(r){for(;;)switch(r.prev=r.next){case 0:t=a.toJSON(),e=vt(t),n=ft(t),l.dispatch(yt(e)),l.dispatch(jt(n));case 5:case"end":return r.stop()}})}),a.fromJSON(V(e)),setTimeout(function(){a.view.resize(),a.trigger("process"),a.trigger("arrange"),L.a.zoomAt(a)},200);case 14:case"end":return r.stop()}})},Lt=n(109),Ht=n(44);var Bt=function(t){var e,n,o=t.width,i=t.height,c=t.edges,u=t.nodes,s=t.onClick;return Object(a.useEffect)(function(){var t=new Lt.graphlib.Graph({multigraph:!0}).setGraph({});u.forEach(function(e){t.setNode(e.name,{label:e.name})}),c.forEach(function(e){var n=u[e.source].name+"-"+u[e.target].name+"-"+e.type;t.setEdge(u[e.source].name,u[e.target].name,{label:e.type.join(",")},n)}),t.nodes().forEach(function(e){var n=t.node(e);n.rx=n.ry=5});var a=Ht.select(e),r=Ht.select(n),o=Ht.zoom().on("zoom",function(){r.attr("transform",Ht.event.transform)});a.call(o),(new Lt.render)(r,t),a.call(o.transform,Ht.zoomIdentity.scale(.7)),a.selectAll(".dagre-d3 .node").on("click",function(e){t.nodes().forEach(function(e){return t.node(e).elem.classList.remove("selected")}),t.node(e).elem.classList.add("selected")})},[c,u,e,n,s]),r.a.createElement("svg",{className:"dagre-d3",ref:function(t){return e=t},width:o,height:i},r.a.createElement("g",{ref:function(t){return n=t}}))};var Jt=function(){var t=Object(c.b)(function(t){return t.d3_graph});return r.a.createElement("div",null,r.a.createElement(Bt,{edges:t.edges,nodes:t.nodes,width:"100%",height:"60vh"}))},Wt=n(413);var zt=function(){var t=Object(c.b)(function(t){return t.states_language_graph}),e=function(t){l.dispatch(Ct(!1)),setTimeout(function(){l.dispatch({type:wt}),l.dispatch(Ct(!0))},500)};return r.a.createElement("div",null,r.a.createElement(Wt.a,{variant:"contained",color:"primary",onClick:e},"Reload"),r.a.createElement("br",null),r.a.createElement("textarea",{cols:"100",rows:"50",value:JSON.stringify(t,void 0,2),onChange:function(t){try{console.log(t.target.value);var e=JSON.parse(t.target.value);l.dispatch(jt(e))}catch(t){console.log(t),console.log("JSON is still invalid")}return!0}}),r.a.createElement("br",null),r.a.createElement(Wt.a,{variant:"contained",color:"primary",onClick:e},"Reload"))},qt=Object(f.a)(function(t){return{root:{display:"flex"},toolbar:{paddingRight:24},toolbarIcon:Object(u.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},t.mixins.toolbar),appBar:{zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},appBarShift:{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})},menuButton:{marginRight:36},menuButtonHidden:{display:"none"},title:{flexGrow:1},drawerPaper:{position:"relative",whiteSpace:"nowrap",width:240,transition:t.transitions.create("width",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})},drawerPaperClose:Object(h.a)({overflowX:"hidden",transition:t.transitions.create("width",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),width:t.spacing(7)},t.breakpoints.up("sm"),{width:t.spacing(9)}),appBarSpacer:t.mixins.toolbar,content:{flexGrow:1,height:"100vh",overflow:"auto"},container:{paddingTop:t.spacing(4),paddingBottom:t.spacing(4)},paper:{padding:t.spacing(2),display:"flex",overflow:"auto",flexDirection:"column"},fixedHeight:{height:"70vh"}}});var Vt=function(){var t=qt(),e=Object(m.a)(t.paper,t.fixedHeight),n=Object(c.b)(function(t){return t.states_language_graph_editor}),a=Object(c.b)(function(t){return t.graph_loaded});return r.a.createElement("div",{className:t.root},r.a.createElement(v.a,null),r.a.createElement(g.a,{position:"absolute",className:Object(m.a)(t.appBar)},r.a.createElement(E.a,{className:t.toolbar},r.a.createElement(b.a,{component:"h1",variant:"h6",color:"inherit",noWrap:!0,className:t.title},"States Language Editor"),r.a.createElement(O.a,{color:"inherit"}))),r.a.createElement("main",{className:t.content},r.a.createElement("div",{className:t.appBarSpacer}),r.a.createElement(_.a,{maxWidth:"xl",className:t.container},r.a.createElement(w.a,{container:!0,spacing:3},r.a.createElement(w.a,{item:!0,xs:12,md:8,lg:8},r.a.createElement(y.a,{className:e},r.a.createElement("h2",null,"Editor"),a?r.a.createElement("div",{ref:function(t){return Dt(t,n)}}):r.a.createElement("div",null,"Loading..."))),r.a.createElement(w.a,{item:!0,xs:12,md:4,lg:4},r.a.createElement(y.a,{className:e},r.a.createElement("h2",null,"Graph"),r.a.createElement(Jt,null))),r.a.createElement(w.a,{item:!0,xs:12},r.a.createElement(y.a,{className:t.paper},r.a.createElement("h2",null,"JSON"),r.a.createElement(zt,null)))))))},Ut=n(422),Ft=n(30),Mt=Object(Ft.a)(),Xt=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(Ut.b,{history:Mt},r.a.createElement(Ut.c,null,r.a.createElement(Ut.a,{path:"/",component:Vt}),r.a.createElement(Ut.a,{path:"/states-language-editor",component:Vt}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(388);"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()}),i.a.render(r.a.createElement(c.a,{store:l},r.a.createElement(Xt,null)),document.getElementById("root"))}},[[188,1,2]]]);
//# sourceMappingURL=main.ce5eaaf8.chunk.js.map